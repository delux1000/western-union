<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transfer Funds - Western Swift Connect</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a237e;
            --secondary: #283593;
            --accent: #5c6bc0;
            --light: #e8eaf6;
            --success: #2e7d32;
            --warning: #f57c00;
            --danger: #c62828;
        }
        
        body {
            background-color: #f5f7fb;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
        }
        
        .navbar-brand {
            font-weight: 700;
            color: var(--primary);
        }
        
        .card {
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: none;
            margin-bottom: 20px;
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 12px 12px 0 0 !important;
            padding: 15px 20px;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .balance-card {
            background: linear-gradient(135deg, #1a237e, #3949ab);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .transaction-item {
            border-left: 4px solid var(--accent);
            padding: 12px 15px;
            margin-bottom: 10px;
            background-color: white;
            border-radius: 0 8px 8px 0;
            transition: all 0.3s ease;
        }
        
        .transaction-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .credit {
            border-left-color: var(--success);
        }
        
        .debit {
            border-left-color: var(--danger);
        }
        
        .form-control {
            border-radius: 8px;
            padding: 10px 15px;
            border: 1px solid #ddd;
        }
        
        .form-control:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 0.2rem rgba(92, 107, 192, 0.25);
        }
        
        .transfer-icon {
            font-size: 48px;
            color: var(--accent);
            margin-bottom: 15px;
        }
        
        .security-notice {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin: 20px 0;
        }
        
        .recent-transactions {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        footer {
            background-color: var(--primary);
            color: white;
            padding: 20px 0;
            margin-top: 40px;
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            position: relative;
        }
        
        .step-indicator::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #e0e0e0;
            z-index: 1;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            font-weight: bold;
            color: #757575;
        }
        
        .step.active .step-circle {
            background-color: var(--primary);
            color: white;
        }
        
        .step.completed .step-circle {
            background-color: var(--success);
            color: white;
        }
        
        .step-label {
            font-size: 12px;
            color: #757575;
            text-align: center;
        }
        
        .step.active .step-label {
            color: var(--primary);
            font-weight: 600;
        }
        
        .transfer-summary {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .payment-type-icon {
            font-size: 24px;
            margin-right: 10px;
        }
        
        .crypto-badge {
            background-color: #f39c12;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 5px;
        }
        
        .currency-converter {
            background-color: #e8f5e9;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            border-left: 4px solid #4caf50;
        }
        
        .conversion-rate {
            font-size: 14px;
            color: #2e7d32;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .step-label {
                font-size: 10px;
            }
            
            .balance-card {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="/dashboard">
                <i class="fas fa-university me-2"></i>Western Swift Connect
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/dashboard"><i class="fas fa-home me-1"></i> Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/transfer"><i class="fas fa-exchange-alt me-1"></i> Transfer</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="history.html"><i class="fas fa-history me-1"></i> History</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/chat"><i class="fas fa-comments me-1"></i> Support</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/notifications">
                            <i class="fas fa-bell me-1"></i> Notifications
                            <span class="notification-badge">3</span>
                        </a>
                    </li>
                </ul>
                <div class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i> <span id="userFullname">User Name</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form id="logoutForm" action="/logout" method="POST">
                                    <button type="submit" class="dropdown-item"><i class="fas fa-sign-out-alt me-2"></i>Logout</button>
                                </form>
                            </li>
                        </ul>
                    </li>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container my-4">
        <div class="row">
            <div class="col-lg-8">
                <!-- Transfer Form Card -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-exchange-alt me-2"></i> Transfer Funds</h5>
                    </div>
                    <div class="card-body">
                        <!-- Step Indicator -->
                        <div class="step-indicator">
                            <div class="step active">
                                <div class="step-circle">1</div>
                                <div class="step-label">Payment Method</div>
                            </div>
                            <div class="step">
                                <div class="step-circle">2</div>
                                <div class="step-label">Recipient Details</div>
                            </div>
                            <div class="step">
                                <div class="step-circle">3</div>
                                <div class="step-label">Transfer Details</div>
                            </div>
                            <div class="step">
                                <div class="step-circle">4</div>
                                <div class="step-label">Confirmation</div>
                            </div>
                        </div>

                        <!-- Transfer Form -->
                        <form id="transferForm">
                            <!-- Step 1: Payment Method -->
                            <div id="step1" class="form-step">
                                <h5 class="mb-3">Select Payment Method</h5>
                                
                                <div class="row">
                                    <div class="col-md-12 mb-3">
                                        <label for="paymentType" class="form-label">Payment Type</label>
                                        <select class="form-select" id="paymentType" name="paymentType" required>
                                            <option value="">Select Payment Type</option>
                                            <optgroup label="Bank Transfers">
                                                <option value="bank_transfer">Bank Transfer</option>
                                                <option value="wire_transfer">Wire Transfer</option>
                                                <option value="ach_transfer">ACH Transfer</option>
                                                <option value="sepa_transfer">SEPA Transfer</option>
                                                <option value="swift_transfer">SWIFT Transfer</option>
                                                <option value="uk_bank">UK Bank Transfer</option>
                                                <option value="canada_bank">Canada Bank Transfer</option>
                                                <option value="australia_bank">Australia Bank Transfer</option>
                                                <option value="europe_bank">European Bank Transfer</option>
                                            </optgroup>
                                            <optgroup label="Digital Wallets">
                                                <option value="paypal">PayPal</option>
                                                <option value="zelle">Zelle</option>
                                                <option value="venmo">Venmo</option>
                                                <option value="cashapp">Cash App</option>
                                                <option value="googlepay">Google Pay</option>
                                                <option value="applepay">Apple Pay</option>
                                                <option value="skrill">Skrill</option>
                                                <option value="neteller">Neteller</option>
                                                <option value="payoneer">Payoneer</option>
                                                <option value="wise">Wise (TransferWise)</option>
                                            </optgroup>
                                            <optgroup label="Cryptocurrencies">
                                                <option value="bitcoin">Bitcoin (BTC)</option>
                                                <option value="ethereum">Ethereum (ETH)</option>
                                                <option value="litecoin">Litecoin (LTC)</option>
                                                <option value="bitcoin_cash">Bitcoin Cash (BCH)</option>
                                                <option value="ripple">Ripple (XRP)</option>
                                                <option value="cardano">Cardano (ADA)</option>
                                                <option value="polkadot">Polkadot (DOT)</option>
                                                <option value="dogecoin">Dogecoin (DOGE)</option>
                                                <option value="solana">Solana (SOL)</option>
                                                <option value="tron">TRON (TRX)</option>
                                                <option value="stellar">Stellar (XLM)</option>
                                                <option value="monero">Monero (XMR)</option>
                                                <option value="dash">Dash</option>
                                                <option value="zcash">Zcash (ZEC)</option>
                                            </optgroup>
                                            <optgroup label="Mobile Money">
                                                <option value="momo_ghana">Mobile Money Ghana</option>
                                                <option value="mpesa_kenya">M-Pesa Kenya</option>
                                                <option value="mtn_momo">MTN Mobile Money</option>
                                                <option value="airtel_money">Airtel Money</option>
                                                <option value="orange_money">Orange Money</option>
                                            </optgroup>
                                            <optgroup label="Other Methods">
                                                <option value="western_union">Western Union</option>
                                                <option value="moneygram">MoneyGram</option>
                                                <option value="ria">Ria Money Transfer</option>
                                                <option value="worldremit">WorldRemit</option>
                                                <option value="remitly">Remitly</option>
                                            </optgroup>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between mt-4">
                                    <button type="button" class="btn btn-secondary" disabled>Previous</button>
                                    <button type="button" class="btn btn-primary" id="nextToStep2">Next</button>
                                </div>
                            </div>
                            
                            <!-- Step 2: Recipient Details (Dynamic based on payment type) -->
                            <div id="step2" class="form-step d-none">
                                <h5 class="mb-3">Recipient Information</h5>
                                
                                <div id="recipientDetailsForm">
                                    <!-- Dynamic form fields will be inserted here based on payment type -->
                                </div>
                                
                                <div class="d-flex justify-content-between mt-4">
                                    <button type="button" class="btn btn-secondary" id="backToStep1">Previous</button>
                                    <button type="button" class="btn btn-primary" id="nextToStep3">Next</button>
                                </div>
                            </div>
                            
                            <!-- Step 3: Transfer Details -->
                            <div id="step3" class="form-step d-none">
                                <h5 class="mb-3">Transfer Details</h5>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="amount" class="form-label">Amount ($)</label>
                                        <input type="number" class="form-control" id="amount" name="amount" min="1" step="0.01" required>
                                        <div class="form-text">Available balance: $<span id="availableBalance">0.00</span></div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="transferDate" class="form-label">Transfer Date</label>
                                        <input type="date" class="form-control" id="transferDate" name="transferDate" required>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="description" class="form-label">Description (Optional)</label>
                                    <textarea class="form-control" id="description" name="description" rows="2" placeholder="Add a note about this transfer"></textarea>
                                </div>
                                
                                <!-- Currency Converter -->
                                <div id="currencyConverter" class="currency-converter d-none">
                                    <h6><i class="fas fa-exchange-alt me-2"></i> Currency Conversion</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="sourceCurrency" class="form-label">From Currency</label>
                                            <select class="form-select" id="sourceCurrency">
                                                <option value="USD">US Dollar (USD)</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="targetCurrency" class="form-label">To Currency</label>
                                            <select class="form-select" id="targetCurrency">
                                                <!-- Options will be populated based on payment type -->
                                            </select>
                                        </div>
                                    </div>
                                    <div class="conversion-rate mt-2">
                                        <span id="conversionRateText">Exchange rate: </span>
                                        <span id="convertedAmountText"></span>
                                    </div>
                                </div>
                                
                                <div class="transfer-summary">
                                    <h6>Transfer Summary</h6>
                                    <div class="row">
                                        <div class="col-6">Payment Method:</div>
                                        <div class="col-6" id="summaryPaymentMethod">-</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">Recipient:</div>
                                        <div class="col-6" id="summaryRecipient">-</div>
                                    </div>
                                    <div id="dynamicSummaryFields">
                                        <!-- Dynamic summary fields will be inserted here -->
                                    </div>
                                    <div class="row">
                                        <div class="col-6">Amount (USD):</div>
                                        <div class="col-6" id="summaryAmount">-</div>
                                    </div>
                                    <div id="convertedAmountSummary" class="d-none">
                                        <!-- Converted amount will be shown here -->
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between mt-4">
                                    <button type="button" class="btn btn-secondary" id="backToStep2">Previous</button>
                                    <button type="button" class="btn btn-primary" id="nextToStep4">Next</button>
                                </div>
                            </div>
                            
                            <!-- Step 4: Confirmation -->
                            <div id="step4" class="form-step d-none">
                                <div class="text-center mb-4">
                                    <i class="fas fa-check-circle text-success" style="font-size: 64px;"></i>
                                    <h4 class="mt-3">Confirm Your Transfer</h4>
                                    <p class="text-muted">Please review the details below before confirming</p>
                                </div>
                                
                                <div class="transfer-summary">
                                    <h6>Transfer Details</h6>
                                    <div class="row mb-2">
                                        <div class="col-6 fw-bold">Payment Method:</div>
                                        <div class="col-6" id="confirmPaymentMethod">-</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-6 fw-bold">From Account:</div>
                                        <div class="col-6" id="confirmFromAccount">-</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-6 fw-bold">To Account:</div>
                                        <div class="col-6" id="confirmToAccount">-</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-6 fw-bold">Recipient Name:</div>
                                        <div class="col-6" id="confirmRecipient">-</div>
                                    </div>
                                    <div id="dynamicConfirmFields">
                                        <!-- Dynamic confirmation fields will be inserted here -->
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-6 fw-bold">Amount (USD):</div>
                                        <div class="col-6 fw-bold text-success" id="confirmAmount">-</div>
                                    </div>
                                    <div id="convertedAmountConfirm" class="d-none">
                                        <!-- Converted amount confirmation will be shown here -->
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-6 fw-bold">Date:</div>
                                        <div class="col-6" id="confirmDate">-</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-6 fw-bold">Description:</div>
                                        <div class="col-6" id="confirmDescription">-</div>
                                    </div>
                                    <hr>
                                    <div class="row mb-2">
                                        <div class="col-6 fw-bold">Transaction Fee:</div>
                                        <div class="col-6">$0.00</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-6 fw-bold">Total Amount (USD):</div>
                                        <div class="col-6 fw-bold text-primary" id="confirmTotal">-</div>
                                    </div>
                                </div>
                                
                                <div class="form-check mb-4">
                                    <input class="form-check-input" type="checkbox" id="confirmCheck" required>
                                    <label class="form-check-label" for="confirmCheck">
                                        I confirm that all the information provided is correct
                                    </label>
                                </div>
                                
                                <div class="d-flex justify-content-between mt-4">
                                    <button type="button" class="btn btn-secondary" id="backToStep3">Previous</button>
                                    <button type="button" class="btn btn-success" id="confirmTransfer">Confirm Transfer</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Security Notice -->
                <div class="security-notice">
                    <h6><i class="fas fa-shield-alt me-2"></i> Security Notice</h6>
                    <p class="mb-0">For your security, all transactions are monitored and encrypted. Never share your login details or OTP with anyone. Western Swift Connect will never ask for your password via email or phone.</p>
                </div>
            </div>
            
            <div class="col-lg-4">
                <!-- Balance Card -->
                <div class="balance-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="mb-1">Available Balance</p>
                            <h2 id="currentBalance">$0.00</h2>
                            <p class="mb-0">Account: <span id="userAccountNumber">-</span></p>
                        </div>
                        <i class="fas fa-wallet fa-3x opacity-75"></i>
                    </div>
                </div>
                
                <!-- Recent Transactions -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-history me-2"></i> Recent Transactions</h5>
                    </div>
                    <div class="card-body">
                        <div class="recent-transactions" id="recentTransactions">
                            <!-- Transactions will be loaded here -->
                            <div class="text-center py-4">
                                <i class="fas fa-spinner fa-spin fa-2x text-muted"></i>
                                <p class="mt-2 text-muted">Loading transactions...</p>
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <a href="history.html" class="btn btn-outline-primary btn-sm">View All Transactions</a>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-bolt me-2"></i> Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="/dashboard" class="btn btn-outline-primary"><i class="fas fa-home me-2"></i> Dashboard</a>
                            <a href="history.html" class="btn btn-outline-primary"><i class="fas fa-list me-2"></i> Transaction History</a>
                            <a href="/chat" class="btn btn-outline-primary"><i class="fas fa-comments me-2"></i> Customer Support</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <h5>Western Swift Connect</h5>
                    <p>Secure and reliable banking services for all your financial needs.</p>
                </div>
                <div class="col-md-2 mb-3">
                    <h5>Services</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-light">Personal Banking</a></li>
                        <li><a href="#" class="text-light">Business Banking</a></li>
                        <li><a href="#" class="text-light">Loans</a></li>
                        <li><a href="#" class="text-light">Investments</a></li>
                    </ul>
                </div>
                <div class="col-md-2 mb-3">
                    <h5>Support</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-light">Help Center</a></li>
                        <li><a href="#" class="text-light">Contact Us</a></li>
                        <li><a href="#" class="text-light">Security Tips</a></li>
                        <li><a href="#" class="text-light">FAQ</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-3">
                    <h5>Contact Info</h5>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-phone me-2"></i> 1-564-westernunion</li>
                        <li><i class="fas fa-envelope me-2"></i> support@westernswiftconnect.com</li>
                        <li><i class="fas fa-map-marker-alt me-2"></i> 123 Financial District, San Francisco, CA</li>
                    </ul>
                </div>
            </div>
            <hr class="my-4">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0">&copy; 2025 Western Swift Connect. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <a href="#" class="text-light me-3"><i class="fab fa-facebook fa-lg"></i></a>
                    <a href="#" class="text-light me-3"><i class="fab fa-twitter fa-lg"></i></a>
                    <a href="#" class="text-light me-3"><i class="fab fa-linkedin fa-lg"></i></a>
                    <a href="#" class="text-light"><i class="fab fa-instagram fa-lg"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Activation Code Modal -->
    <div class="modal fade" id="activationModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title"><i class="fas fa-lock me-2"></i> Security Verification</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="fas fa-shield-alt text-primary mb-3" style="font-size: 64px;"></i>
                    <h4>Enter Activation Code</h4>
                    <p>Please enter the activation code to complete your transfer.</p>
                    <div class="mb-3">
                        <input type="text" class="form-control form-control-lg text-center" id="activationCode" placeholder="Enter activation code" maxlength="8">
                        <div class="form-text">Enter the 8-digit activation code</div>
                    </div>
                    <div id="activationError" class="alert alert-danger d-none">
                        <i class="fas fa-exclamation-circle me-2"></i> Invalid activation code. 
                        <a href="/chat" class="alert-link">Click here to contact customer support</a> to purchase your code.
                    </div>
                </div>
                <div class="modal-footer border-0 justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="verifyActivationCode">Verify Code</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title text-success"><i class="fas fa-check-circle me-2"></i> Transfer Successful</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="fas fa-check-circle text-success mb-3" style="font-size: 64px;"></i>
                    <h4>Transfer Completed!</h4>
                    <p>Your transfer of <strong id="successAmount">$0.00</strong> to <strong id="successRecipient">Recipient Name</strong> has been processed successfully.</p>
                    <p class="mb-0">Transaction ID: <span id="successTransactionId" class="text-muted">-</span></p>
                </div>
                <div class="modal-footer border-0 justify-content-center">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Done</button>
                    <button type="button" class="btn btn-outline-primary" id="printReceipt">Print Receipt</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div class="modal fade" id="errorModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title text-danger"><i class="fas fa-exclamation-circle me-2"></i> Transfer Failed</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="fas fa-times-circle text-danger mb-3" style="font-size: 64px;"></i>
                    <h4>Transfer Unsuccessful</h4>
                    <p id="errorMessage">An error occurred while processing your transfer. Please try again.</p>
                </div>
                <div class="modal-footer border-0 justify-content-center">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Try Again</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Current user data
        let userData = null;
        let currentStep = 1;
        const CORRECT_ACTIVATION_CODE = "33898989";
        let currentExchangeRate = 1;
        let targetCurrency = 'USD';
        
        // Payment type configurations
        const paymentTypes = {
            bank_transfer: {
                name: "Bank Transfer",
                icon: "fa-university",
                currency: "USD",
                fields: [
                    { name: "accountNumber", label: "Account Number", type: "text", required: true },
                    { name: "routingNumber", label: "Routing Number / SWIFT Code", type: "text", required: true },
                    { name: "bankName", label: "Bank Name", type: "text", required: true },
                    { name: "accountName", label: "Account Holder Name", type: "text", required: true }
                ]
            },
            wire_transfer: {
                name: "Wire Transfer",
                icon: "fa-money-check",
                currency: "USD",
                fields: [
                    { name: "accountNumber", label: "Account Number", type: "text", required: true },
                    { name: "swiftCode", label: "SWIFT/BIC Code", type: "text", required: true },
                    { name: "bankName", label: "Bank Name", type: "text", required: true },
                    { name: "bankAddress", label: "Bank Address", type: "text", required: true },
                    { name: "accountName", label: "Account Holder Name", type: "text", required: true }
                ]
            },
            ach_transfer: {
                name: "ACH Transfer",
                icon: "fa-landmark",
                currency: "USD",
                fields: [
                    { name: "accountNumber", label: "Account Number", type: "text", required: true },
                    { name: "routingNumber", label: "Routing Number", type: "text", required: true },
                    { name: "accountName", label: "Account Holder Name", type: "text", required: true },
                    { name: "accountType", label: "Account Type", type: "select", required: true, options: ["Checking", "Savings"] }
                ]
            },
            sepa_transfer: {
                name: "SEPA Transfer",
                icon: "fa-euro-sign",
                currency: "EUR",
                fields: [
                    { name: "iban", label: "IBAN", type: "text", required: true },
                    { name: "bic", label: "BIC/SWIFT Code", type: "text", required: true },
                    { name: "bankName", label: "Bank Name", type: "text", required: true },
                    { name: "accountName", label: "Account Holder Name", type: "text", required: true }
                ]
            },
            swift_transfer: {
                name: "SWIFT Transfer",
                icon: "fa-globe",
                currency: "USD",
                fields: [
                    { name: "accountNumber", label: "Account Number", type: "text", required: true },
                    { name: "swiftCode", label: "SWIFT/BIC Code", type: "text", required: true },
                    { name: "bankName", label: "Bank Name", type: "text", required: true },
                    { name: "bankAddress", label: "Bank Address", type: "text", required: true },
                    { name: "accountName", label: "Account Holder Name", type: "text", required: true },
                    { name: "intermediaryBank", label: "Intermediary Bank (if any)", type: "text", required: false }
                ]
            },
            uk_bank: {
                name: "UK Bank Transfer",
                icon: "fa-pound-sign",
                currency: "GBP",
                fields: [
                    { name: "accountNumber", label: "Account Number", type: "text", required: true },
                    { name: "sortCode", label: "Sort Code", type: "text", required: true },
                    { name: "bankName", label: "Bank Name", type: "text", required: true },
                    { name: "accountName", label: "Account Holder Name", type: "text", required: true }
                ]
            },
            canada_bank: {
                name: "Canada Bank Transfer",
                icon: "fa-dollar-sign",
                currency: "CAD",
                fields: [
                    { name: "accountNumber", label: "Account Number", type: "text", required: true },
                    { name: "transitNumber", label: "Transit Number", type: "text", required: true },
                    { name: "institutionNumber", label: "Institution Number", type: "text", required: true },
                    { name: "bankName", label: "Bank Name", type: "text", required: true },
                    { name: "accountName", label: "Account Holder Name", type: "text", required: true }
                ]
            },
            australia_bank: {
                name: "Australia Bank Transfer",
                icon: "fa-dollar-sign",
                currency: "AUD",
                fields: [
                    { name: "accountNumber", label: "Account Number", type: "text", required: true },
                    { name: "bsbCode", label: "BSB Code", type: "text", required: true },
                    { name: "bankName", label: "Bank Name", type: "text", required: true },
                    { name: "accountName", label: "Account Holder Name", type: "text", required: true }
                ]
            },
            europe_bank: {
                name: "European Bank Transfer",
                icon: "fa-euro-sign",
                currency: "EUR",
                fields: [
                    { name: "iban", label: "IBAN", type: "text", required: true },
                    { name: "bic", label: "BIC Code", type: "text", required: true },
                    { name: "bankName", label: "Bank Name", type: "text", required: true },
                    { name: "accountName", label: "Account Holder Name", type: "text", required: true }
                ]
            },
            paypal: {
                name: "PayPal",
                icon: "fa-paypal",
                currency: "USD",
                fields: [
                    { name: "paypalEmail", label: "PayPal Email", type: "email", required: true },
                    { name: "paypalName", label: "PayPal Account Name", type: "text", required: true }
                ]
            },
            zelle: {
                name: "Zelle",
                icon: "fa-money-bill-wave",
                currency: "USD",
                fields: [
                    { name: "zelleEmail", label: "Zelle Email or Phone", type: "text", required: true },
                    { name: "zelleName", label: "Recipient Name", type: "text", required: true }
                ]
            },
            venmo: {
                name: "Venmo",
                icon: "fa-mobile-alt",
                currency: "USD",
                fields: [
                    { name: "venmoUsername", label: "Venmo Username", type: "text", required: true },
                    { name: "venmoName", label: "Recipient Name", type: "text", required: true }
                ]
            },
            cashapp: {
                name: "Cash App",
                icon: "fa-dollar-sign",
                currency: "USD",
                fields: [
                    { name: "cashappTag", label: "Cash App Tag", type: "text", required: true },
                    { name: "cashappName", label: "Recipient Name", type: "text", required: true }
                ]
            },
            googlepay: {
                name: "Google Pay",
                icon: "fa-google",
                currency: "USD",
                fields: [
                    { name: "googlepayEmail", label: "Google Pay Email", type: "email", required: true },
                    { name: "googlepayName", label: "Recipient Name", type: "text", required: true }
                ]
            },
            applepay: {
                name: "Apple Pay",
                icon: "fa-apple",
                currency: "USD",
                fields: [
                    { name: "applepayEmail", label: "Apple Pay Email", type: "email", required: true },
                    { name: "applepayName", label: "Recipient Name", type: "text", required: true }
                ]
            },
            skrill: {
                name: "Skrill",
                icon: "fa-wallet",
                currency: "USD",
                fields: [
                    { name: "skrillEmail", label: "Skrill Email", type: "email", required: true },
                    { name: "skrillName", label: "Recipient Name", type: "text", required: true }
                ]
            },
            neteller: {
                name: "Neteller",
                icon: "fa-credit-card",
                currency: "USD",
                fields: [
                    { name: "netellerEmail", label: "Neteller Email", type: "email", required: true },
                    { name: "netellerName", label: "Recipient Name", type: "text", required: true }
                ]
            },
            payoneer: {
                name: "Payoneer",
                icon: "fa-globe",
                currency: "USD",
                fields: [
                    { name: "payoneerEmail", label: "Payoneer Email", type: "email", required: true },
                    { name: "payoneerName", label: "Recipient Name", type: "text", required: true }
                ]
            },
            wise: {
                name: "Wise (TransferWise)",
                icon: "fa-money-bill-transfer",
                currency: "USD",
                fields: [
                    { name: "wiseEmail", label: "Wise Email", type: "email", required: true },
                    { name: "wiseName", label: "Recipient Name", type: "text", required: true }
                ]
            },
            bitcoin: {
                name: "Bitcoin (BTC)",
                icon: "fa-bitcoin",
                currency: "BTC",
                fields: [
                    { name: "walletAddress", label: "Bitcoin Wallet Address", type: "text", required: true },
                    { name: "walletName", label: "Wallet Name (Optional)", type: "text", required: false }
                ]
            },
            ethereum: {
                name: "Ethereum (ETH)",
                icon: "fa-ethereum",
                currency: "ETH",
                fields: [
                    { name: "walletAddress", label: "Ethereum Wallet Address", type: "text", required: true },
                    { name: "walletName", label: "Wallet Name (Optional)", type: "text", required: false }
                ]
            },
            litecoin: {
                name: "Litecoin (LTC)",
                icon: "fa-coins",
                currency: "LTC",
                fields: [
                    { name: "walletAddress", label: "Litecoin Wallet Address", type: "text", required: true },
                    { name: "walletName", label: "Wallet Name (Optional)", type: "text", required: false }
                ]
            },
            bitcoin_cash: {
                name: "Bitcoin Cash (BCH)",
                icon: "fa-bitcoin",
                currency: "BCH",
                fields: [
                    { name: "walletAddress", label: "Bitcoin Cash Wallet Address", type: "text", required: true },
                    { name: "walletName", label: "Wallet Name (Optional)", type: "text", required: false }
                ]
            },
            ripple: {
                name: "Ripple (XRP)",
                icon: "fa-coins",
                currency: "XRP",
                fields: [
                    { name: "walletAddress", label: "XRP Wallet Address", type: "text", required: true },
                    { name: "destinationTag", label: "Destination Tag", type: "text", required: true }
                ]
            },
            cardano: {
                name: "Cardano (ADA)",
                icon: "fa-coins",
                currency: "ADA",
                fields: [
                    { name: "walletAddress", label: "Cardano Wallet Address", type: "text", required: true },
                    { name: "walletName", label: "Wallet Name (Optional)", type: "text", required: false }
                ]
            },
            polkadot: {
                name: "Polkadot (DOT)",
                icon: "fa-circle",
                currency: "DOT",
                fields: [
                    { name: "walletAddress", label: "Polkadot Wallet Address", type: "text", required: true },
                    { name: "walletName", label: "Wallet Name (Optional)", type: "text", required: false }
                ]
            },
            dogecoin: {
                name: "Dogecoin (DOGE)",
                icon: "fa-dog",
                currency: "DOGE",
                fields: [
                    { name: "walletAddress", label: "Dogecoin Wallet Address", type: "text", required: true },
                    { name: "walletName", label: "Wallet Name (Optional)", type: "text", required: false }
                ]
            },
            solana: {
                name: "Solana (SOL)",
                icon: "fa-sun",
                currency: "SOL",
                fields: [
                    { name: "walletAddress", label: "Solana Wallet Address", type: "text", required: true },
                    { name: "walletName", label: "Wallet Name (Optional)", type: "text", required: false }
                ]
            },
            tron: {
                name: "TRON (TRX)",
                icon: "fa-bolt",
                currency: "TRX",
                fields: [
                    { name: "walletAddress", label: "TRON Wallet Address", type: "text", required: true },
                    { name: "walletName", label: "Wallet Name (Optional)", type: "text", required: false }
                ]
            },
            stellar: {
                name: "Stellar (XLM)",
                icon: "fa-star",
                currency: "XLM",
                fields: [
                    { name: "walletAddress", label: "Stellar Wallet Address", type: "text", required: true },
                    { name: "memo", label: "Memo (Optional)", type: "text", required: false }
                ]
            },
            monero: {
                name: "Monero (XMR)",
                icon: "fa-user-secret",
                currency: "XMR",
                fields: [
                    { name: "walletAddress", label: "Monero Wallet Address", type: "text", required: true },
                    { name: "paymentId", label: "Payment ID (Optional)", type: "text", required: false }
                ]
            },
            dash: {
                name: "Dash",
                icon: "fa-rocket",
                currency: "DASH",
                fields: [
                    { name: "walletAddress", label: "Dash Wallet Address", type: "text", required: true },
                    { name: "walletName", label: "Wallet Name (Optional)", type: "text", required: false }
                ]
            },
            zcash: {
                name: "Zcash (ZEC)",
                icon: "fa-shield-alt",
                currency: "ZEC",
                fields: [
                    { name: "walletAddress", label: "Zcash Wallet Address", type: "text", required: true },
                    { name: "memo", label: "Memo (Optional)", type: "text", required: false }
                ]
            },
            momo_ghana: {
                name: "Mobile Money Ghana",
                icon: "fa-mobile-alt",
                currency: "GHS",
                fields: [
                    { name: "phoneNumber", label: "Mobile Money Number", type: "text", required: true },
                    { name: "network", label: "Mobile Network", type: "select", required: true, options: ["MTN", "Vodafone", "AirtelTigo"] },
                    { name: "accountName", label: "Account Holder Name", type: "text", required: true }
                ]
            },
            mpesa_kenya: {
                name: "M-Pesa Kenya",
                icon: "fa-mobile-alt",
                currency: "KES",
                fields: [
                    { name: "phoneNumber", label: "M-Pesa Number", type: "text", required: true },
                    { name: "accountName", label: "Account Holder Name", type: "text", required: true }
                ]
            },
            mtn_momo: {
                name: "MTN Mobile Money",
                icon: "fa-mobile-alt",
                currency: "XAF",
                fields: [
                    { name: "phoneNumber", label: "Mobile Money Number", type: "text", required: true },
                    { name: "accountName", label: "Account Holder Name", type: "text", required: true }
                ]
            },
            airtel_money: {
                name: "Airtel Money",
                icon: "fa-mobile-alt",
                currency: "XAF",
                fields: [
                    { name: "phoneNumber", label: "Airtel Money Number", type: "text", required: true },
                    { name: "accountName", label: "Account Holder Name", type: "text", required: true }
                ]
            },
            orange_money: {
                name: "Orange Money",
                icon: "fa-mobile-alt",
                currency: "XAF",
                fields: [
                    { name: "phoneNumber", label: "Orange Money Number", type: "text", required: true },
                    { name: "accountName", label: "Account Holder Name", type: "text", required: true }
                ]
            },
            western_union: {
                name: "Western Union",
                icon: "fa-globe-americas",
                currency: "USD",
                fields: [
                    { name: "receiverName", label: "Receiver Full Name", type: "text", required: true },
                    { name: "receiverCountry", label: "Receiver Country", type: "text", required: true },
                    { name: "receiverCity", label: "Receiver City", type: "text", required: true },
                    { name: "receiverAddress", label: "Receiver Address", type: "text", required: false }
                ]
            },
            moneygram: {
                name: "MoneyGram",
                icon: "fa-money-bill-wave",
                currency: "USD",
                fields: [
                    { name: "receiverName", label: "Receiver Full Name", type: "text", required: true },
                    { name: "receiverCountry", label: "Receiver Country", type: "text", required: true },
                    { name: "receiverCity", label: "Receiver City", type: "text", required: true },
                    { name: "referenceNumber", label: "Reference Number", type: "text", required: true }
                ]
            },
            ria: {
                name: "Ria Money Transfer",
                icon: "fa-money-check",
                currency: "USD",
                fields: [
                    { name: "receiverName", label: "Receiver Full Name", type: "text", required: true },
                    { name: "receiverCountry", label: "Receiver Country", type: "text", required: true },
                    { name: "receiverCity", label: "Receiver City", type: "text", required: true },
                    { name: "pickupCode", label: "Pickup Code", type: "text", required: true }
                ]
            },
            worldremit: {
                name: "WorldRemit",
                icon: "fa-plane",
                currency: "USD",
                fields: [
                    { name: "receiverName", label: "Receiver Full Name", type: "text", required: true },
                    { name: "receiverCountry", label: "Receiver Country", type: "text", required: true },
                    { name: "receiverPhone", label: "Receiver Phone", type: "text", required: true },
                    { name: "deliveryMethod", label: "Delivery Method", type: "select", required: true, options: ["Bank Transfer", "Cash Pickup", "Mobile Money"] }
                ]
            },
            remitly: {
                name: "Remitly",
                icon: "fa-paper-plane",
                currency: "USD",
                fields: [
                    { name: "receiverName", label: "Receiver Full Name", type: "text", required: true },
                    { name: "receiverCountry", label: "Receiver Country", type: "text", required: true },
                    { name: "receiverPhone", label: "Receiver Phone", type: "text", required: true },
                    { name: "deliveryMethod", label: "Delivery Method", type: "select", required: true, options: ["Bank Deposit", "Cash Pickup", "Mobile Wallet"] }
                ]
            }
        };

        // Crypto exchange rates (simulated - in a real app, you would use an API)
        const cryptoRates = {
            BTC: 0.000025,  // 1 USD = 0.000025 BTC
            ETH: 0.0004,    // 1 USD = 0.0004 ETH
            LTC: 0.005,     // 1 USD = 0.005 LTC
            BCH: 0.002,     // 1 USD = 0.002 BCH
            XRP: 1.5,       // 1 USD = 1.5 XRP
            ADA: 2.0,       // 1 USD = 2.0 ADA
            DOT: 0.1,       // 1 USD = 0.1 DOT
            DOGE: 10,       // 1 USD = 10 DOGE
            SOL: 0.05,      // 1 USD = 0.05 SOL
            TRX: 15,        // 1 USD = 15 TRX
            XLM: 5,         // 1 USD = 5 XLM
            XMR: 0.0006,    // 1 USD = 0.0006 XMR
            DASH: 0.003,    // 1 USD = 0.003 DASH
            ZEC: 0.008      // 1 USD = 0.008 ZEC
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Load user data
            fetchUserData();
            
            // Set today's date as default for transfer date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transferDate').value = today;
            
            // Step navigation handlers
            document.getElementById('nextToStep2').addEventListener('click', goToStep2);
            document.getElementById('nextToStep3').addEventListener('click', goToStep3);
            document.getElementById('nextToStep4').addEventListener('click', goToStep4);
            document.getElementById('backToStep1').addEventListener('click', goToStep1);
            document.getElementById('backToStep2').addEventListener('click', goToStep2FromStep3);
            document.getElementById('backToStep3').addEventListener('click', goToStep3FromStep4);
            
            // Form submission
            document.getElementById('confirmTransfer').addEventListener('click', showActivationModal);
            document.getElementById('verifyActivationCode').addEventListener('click', verifyActivationCode);
            
            // Payment type change handler
            document.getElementById('paymentType').addEventListener('change', updatePaymentTypeFields);
            
            // Amount change handler for currency conversion
            document.getElementById('amount').addEventListener('input', updateCurrencyConversion);
        });
        
        // Fetch user data from the server
        function fetchUserData() {
            fetch('/data')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    userData = data;
                    updateUIWithUserData();
                    loadRecentTransactions();
                })
                .catch(error => {
                    console.error('Error fetching user data:', error);
                    // Redirect to login if unauthorized
                    if (error.message.includes('401')) {
                        window.location.href = '/login';
                    }
                });
        }
        
        // Update UI with user data
        function updateUIWithUserData() {
            if (userData) {
                document.getElementById('userFullname').textContent = userData.fullname;
                document.getElementById('currentBalance').textContent = `$${parseFloat(userData.balance).toFixed(2)}`;
                document.getElementById('availableBalance').textContent = parseFloat(userData.balance).toFixed(2);
                document.getElementById('userAccountNumber').textContent = userData.account_number;
                document.getElementById('confirmFromAccount').textContent = userData.account_number;
            }
        }
        
        // Load recent transactions
        function loadRecentTransactions() {
            fetch('/history')
                .then(response => response.json())
                .then(transactions => {
                    const container = document.getElementById('recentTransactions');
                    container.innerHTML = '';
                    
                    if (transactions.length === 0) {
                        container.innerHTML = '<p class="text-muted text-center py-4">No recent transactions</p>';
                        return;
                    }
                    
                    // Show only the last 5 transactions
                    const recent = transactions.slice(-5).reverse();
                    
                    recent.forEach(transaction => {
                        const transactionEl = document.createElement('div');
                        transactionEl.className = `transaction-item ${transaction.type}`;
                        
                        const typeIcon = transaction.type === 'credit' ? 
                            '<i class="fas fa-arrow-down text-success me-2"></i>' : 
                            '<i class="fas fa-arrow-up text-danger me-2"></i>';
                        
                        const amountClass = transaction.type === 'credit' ? 'text-success' : 'text-danger';
                        
                        transactionEl.innerHTML = `
                            <div class="d-flex justify-content-between">
                                <div>
                                    <strong>${transaction.senderName || transaction.to || 'N/A'}</strong>
                                    <br>
                                    <small class="text-muted">${new Date(transaction.date).toLocaleDateString()}</small>
                                </div>
                                <div class="text-end">
                                    <span class="${amountClass}">${transaction.type === 'credit' ? '+' : '-'}$${parseFloat(transaction.amount).toFixed(2)}</span>
                                    <br>
                                    <small class="text-muted">${transaction.transactionId}</small>
                                </div>
                            </div>
                        `;
                        
                        container.appendChild(transactionEl);
                    });
                })
                .catch(error => {
                    console.error('Error loading transactions:', error);
                    document.getElementById('recentTransactions').innerHTML = 
                        '<p class="text-danger text-center py-4">Error loading transactions</p>';
                });
        }
        
        // Update form fields based on selected payment type
        function updatePaymentTypeFields() {
            const paymentType = document.getElementById('paymentType').value;
            const formContainer = document.getElementById('recipientDetailsForm');
            
            if (!paymentType) {
                formContainer.innerHTML = '<p class="text-muted">Please select a payment type</p>';
                return;
            }
            
            const paymentConfig = paymentTypes[paymentType];
            let html = '';
            
            paymentConfig.fields.forEach(field => {
                if (field.type === 'select') {
                    html += `
                        <div class="mb-3">
                            <label for="${field.name}" class="form-label">${field.label}</label>
                            <select class="form-select" id="${field.name}" name="${field.name}" ${field.required ? 'required' : ''}>
                                <option value="">Select ${field.label}</option>
                                ${field.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
                            </select>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="mb-3">
                            <label for="${field.name}" class="form-label">${field.label}</label>
                            <input type="${field.type}" class="form-control" id="${field.name}" name="${field.name}" ${field.required ? 'required' : ''}>
                        </div>
                    `;
                }
            });
            
            formContainer.innerHTML = html;
            
            // Update currency converter based on payment type
            updateCurrencyConverter(paymentConfig.currency);
        }
        
        // Update currency converter based on selected payment type
        function updateCurrencyConverter(currency) {
            const converter = document.getElementById('currencyConverter');
            const targetCurrencySelect = document.getElementById('targetCurrency');
            
            // Show converter if currency is not USD
            if (currency !== 'USD') {
                converter.classList.remove('d-none');
                targetCurrency = currency;
                
                // Update target currency options
                targetCurrencySelect.innerHTML = '';
                
                // Add currency options based on payment type
                if (currency in cryptoRates) {
                    // It's a cryptocurrency
                    targetCurrencySelect.innerHTML = `<option value="${currency}">${currency}</option>`;
                } else {
                    // It's a fiat currency
                    targetCurrencySelect.innerHTML = `<option value="${currency}">${currency}</option>`;
                }
                
                // Update conversion rate
                updateCurrencyConversion();
            } else {
                converter.classList.add('d-none');
                targetCurrency = 'USD';
                currentExchangeRate = 1;
            }
        }
        
        // Update currency conversion when amount changes
        function updateCurrencyConversion() {
            const amount = parseFloat(document.getElementById('amount').value) || 0;
            const conversionRateText = document.getElementById('conversionRateText');
            const convertedAmountText = document.getElementById('convertedAmountText');
            
            if (targetCurrency === 'USD') {
                conversionRateText.textContent = 'Exchange rate: 1 USD = 1 USD';
                convertedAmountText.textContent = '';
                return;
            }
            
            // Get exchange rate (in a real app, you would use an API)
            let rate = 1;
            if (targetCurrency in cryptoRates) {
                // Cryptocurrency
                rate = cryptoRates[targetCurrency];
                conversionRateText.textContent = `Exchange rate: 1 USD = ${rate} ${targetCurrency}`;
                convertedAmountText.textContent = `Converted amount: ${(amount * rate).toFixed(8)} ${targetCurrency}`;
            } else {
                // Fiat currency - using a free API (example with fallback)
                fetch(`https://api.exchangerate-api.com/v4/latest/USD`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.rates && data.rates[targetCurrency]) {
                            rate = data.rates[targetCurrency];
                            currentExchangeRate = rate;
                            conversionRateText.textContent = `Exchange rate: 1 USD = ${rate.toFixed(4)} ${targetCurrency}`;
                            convertedAmountText.textContent = `Converted amount: ${(amount * rate).toFixed(2)} ${targetCurrency}`;
                        } else {
                            // Fallback rates if API fails
                            const fallbackRates = {
                                'EUR': 0.85, 'GBP': 0.73, 'CAD': 1.25, 'AUD': 1.35, 
                                'GHS': 5.8, 'KES': 110, 'XAF': 550, 'NGN': 410
                            };
                            rate = fallbackRates[targetCurrency] || 1;
                            currentExchangeRate = rate;
                            conversionRateText.textContent = `Exchange rate: 1 USD  ${rate} ${targetCurrency}`;
                            convertedAmountText.textContent = `Converted amount: ${(amount * rate).toFixed(2)} ${targetCurrency}`;
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching exchange rate:', error);
                        // Fallback rates
                        const fallbackRates = {
                            'EUR': 0.85, 'GBP': 0.73, 'CAD': 1.25, 'AUD': 1.35, 
                            'GHS': 5.8, 'KES': 110, 'XAF': 550, 'NGN': 410
                        };
                        rate = fallbackRates[targetCurrency] || 1;
                        currentExchangeRate = rate;
                        conversionRateText.textContent = `Exchange rate: 1 USD  ${rate} ${targetCurrency}`;
                        convertedAmountText.textContent = `Converted amount: ${(amount * rate).toFixed(2)} ${targetCurrency}`;
                    });
            }
        }
        
        // Step navigation functions
        function goToStep2() {
            const paymentType = document.getElementById('paymentType').value;
            
            if (!paymentType) {
                alert('Please select a payment type');
                return;
            }
            
            // Update summary
            document.getElementById('summaryPaymentMethod').textContent = paymentTypes[paymentType].name;
            document.getElementById('confirmPaymentMethod').textContent = paymentTypes[paymentType].name;
            
            // Switch to step 2
            document.getElementById('step1').classList.add('d-none');
            document.getElementById('step2').classList.remove('d-none');
            updateStepIndicator(2);
            currentStep = 2;
            
            // Update payment type fields
            updatePaymentTypeFields();
        }
        
        function goToStep3() {
            // Validate step 2 inputs
            const paymentType = document.getElementById('paymentType').value;
            const paymentConfig = paymentTypes[paymentType];
            let isValid = true;
            
            paymentConfig.fields.forEach(field => {
                const input = document.getElementById(field.name);
                if (field.required && !input.value) {
                    isValid = false;
                    input.classList.add('is-invalid');
                } else {
                    input.classList.remove('is-invalid');
                }
            });
            
            if (!isValid) {
                alert('Please fill in all required recipient details');
                return;
            }
            
            // Update summary with recipient details
            const recipientNameField = paymentConfig.fields.find(f => 
                f.name.includes('Name') || f.name.includes('name') || 
                f.name.includes('receiverName') || f.name.includes('accountName')
            );
            if (recipientNameField) {
                const recipientName = document.getElementById(recipientNameField.name).value;
                document.getElementById('summaryRecipient').textContent = recipientName;
                document.getElementById('confirmRecipient').textContent = recipientName;
                document.getElementById('confirmToAccount').textContent = recipientName;
            }
            
            // Update dynamic summary fields
            let dynamicSummaryHtml = '';
            paymentConfig.fields.forEach(field => {
                const value = document.getElementById(field.name).value;
                dynamicSummaryHtml += `
                    <div class="row">
                        <div class="col-6">${field.label}:</div>
                        <div class="col-6">${value}</div>
                    </div>
                `;
            });
            document.getElementById('dynamicSummaryFields').innerHTML = dynamicSummaryHtml;
            
            // Update dynamic confirmation fields
            let dynamicConfirmHtml = '';
            paymentConfig.fields.forEach(field => {
                const value = document.getElementById(field.name).value;
                dynamicConfirmHtml += `
                    <div class="row mb-2">
                        <div class="col-6 fw-bold">${field.label}:</div>
                        <div class="col-6">${value}</div>
                    </div>
                `;
            });
            document.getElementById('dynamicConfirmFields').innerHTML = dynamicConfirmHtml;
            
            // Switch to step 3
            document.getElementById('step2').classList.add('d-none');
            document.getElementById('step3').classList.remove('d-none');
            updateStepIndicator(3);
            currentStep = 3;
            
            // Update currency conversion
            updateCurrencyConversion();
        }
        
        function goToStep4() {
            // Validate step 3 inputs
            const amount = document.getElementById('amount').value;
            const transferDate = document.getElementById('transferDate').value;
            
            if (!amount || amount <= 0) {
                alert('Please enter a valid amount');
                return;
            }
            
            if (parseFloat(amount) > parseFloat(userData.balance)) {
                alert('Insufficient funds for this transfer');
                return;
            }
            
            if (!transferDate) {
                alert('Please select a transfer date');
                return;
            }
            
            // Update summary
            document.getElementById('summaryAmount').textContent = `$${parseFloat(amount).toFixed(2)}`;
            
            // Update converted amount in summary if applicable
            const convertedAmountSummary = document.getElementById('convertedAmountSummary');
            if (targetCurrency !== 'USD') {
                const convertedAmount = (parseFloat(amount) * currentExchangeRate).toFixed(
                    targetCurrency in cryptoRates ? 8 : 2
                );
                convertedAmountSummary.innerHTML = `
                    <div class="row">
                        <div class="col-6">Amount (${targetCurrency}):</div>
                        <div class="col-6">${convertedAmount} ${targetCurrency}</div>
                    </div>
                `;
                convertedAmountSummary.classList.remove('d-none');
            } else {
                convertedAmountSummary.classList.add('d-none');
            }
            
            // Update confirmation section
            document.getElementById('confirmAmount').textContent = `$${parseFloat(amount).toFixed(2)}`;
            document.getElementById('confirmTotal').textContent = `$${parseFloat(amount).toFixed(2)}`;
            document.getElementById('confirmDate').textContent = new Date(transferDate).toLocaleDateString();
            document.getElementById('confirmDescription').textContent = 
                document.getElementById('description').value || 'No description';
            
            // Update converted amount in confirmation if applicable
            const convertedAmountConfirm = document.getElementById('convertedAmountConfirm');
            if (targetCurrency !== 'USD') {
                const convertedAmount = (parseFloat(amount) * currentExchangeRate).toFixed(
                    targetCurrency in cryptoRates ? 8 : 2
                );
                convertedAmountConfirm.innerHTML = `
                    <div class="row mb-2">
                        <div class="col-6 fw-bold">Amount (${targetCurrency}):</div>
                        <div class="col-6 fw-bold text-primary">${convertedAmount} ${targetCurrency}</div>
                    </div>
                `;
                convertedAmountConfirm.classList.remove('d-none');
            } else {
                convertedAmountConfirm.classList.add('d-none');
            }
            
            // Switch to step 4
            document.getElementById('step3').classList.add('d-none');
            document.getElementById('step4').classList.remove('d-none');
            updateStepIndicator(4);
            currentStep = 4;
        }
        
        function goToStep1() {
            document.getElementById('step2').classList.add('d-none');
            document.getElementById('step1').classList.remove('d-none');
            updateStepIndicator(1);
            currentStep = 1;
        }
        
        function goToStep2FromStep3() {
            document.getElementById('step3').classList.add('d-none');
            document.getElementById('step2').classList.remove('d-none');
            updateStepIndicator(2);
            currentStep = 2;
        }
        
        function goToStep3FromStep4() {
            document.getElementById('step4').classList.add('d-none');
            document.getElementById('step3').classList.remove('d-none');
            updateStepIndicator(3);
            currentStep = 3;
        }
        
        function updateStepIndicator(step) {
            const steps = document.querySelectorAll('.step');
            
            steps.forEach((s, index) => {
                s.classList.remove('active', 'completed');
                
                if (index + 1 < step) {
                    s.classList.add('completed');
                } else if (index + 1 === step) {
                    s.classList.add('active');
                }
            });
        }
        
        // Show activation code modal
        function showActivationModal() {
            // Check confirmation checkbox
            if (!document.getElementById('confirmCheck').checked) {
                alert('Please confirm that the information is correct');
                return;
            }
            
            // Show activation modal
            const activationModal = new bootstrap.Modal(document.getElementById('activationModal'));
            activationModal.show();
            document.getElementById('activationError').classList.add('d-none');
            document.getElementById('activationCode').value = '';
        }
        
        // Verify activation code
        function verifyActivationCode() {
            const enteredCode = document.getElementById('activationCode').value;
            const errorDiv = document.getElementById('activationError');
            
            if (enteredCode === CORRECT_ACTIVATION_CODE) {
                // Code is correct, proceed with transfer
                errorDiv.classList.add('d-none');
                const activationModal = bootstrap.Modal.getInstance(document.getElementById('activationModal'));
                activationModal.hide();
                handleTransfer();
            } else {
                // Code is incorrect
                errorDiv.classList.remove('d-none');
            }
        }
        
        // Handle transfer form submission
        function handleTransfer() {
            // Get form data
            const paymentType = document.getElementById('paymentType').value;
            const paymentConfig = paymentTypes[paymentType];
            const formData = {
                paymentType: paymentType,
                amount: document.getElementById('amount').value,
                description: document.getElementById('description').value,
                transferDate: document.getElementById('transferDate').value,
                targetCurrency: targetCurrency,
                exchangeRate: currentExchangeRate
            };
            
            // Add payment-specific fields
            paymentConfig.fields.forEach(field => {
                formData[field.name] = document.getElementById(field.name).value;
            });
            
            // Show loading state
            const confirmBtn = document.getElementById('confirmTransfer');
            confirmBtn.disabled = true;
            confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Processing...';
            
            // Send transfer request
            fetch('/api/transfer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.message === 'Transfer successful!') {
                    // Show success modal
                    document.getElementById('successAmount').textContent = `$${parseFloat(formData.amount).toFixed(2)}`;
                    
                    const recipientNameField = paymentConfig.fields.find(f => 
                        f.name.includes('Name') || f.name.includes('name') || 
                        f.name.includes('receiverName') || f.name.includes('accountName')
                    );
                    if (recipientNameField) {
                        document.getElementById('successRecipient').textContent = formData[recipientNameField.name];
                    }
                    
                    document.getElementById('successTransactionId').textContent = 
                        'txn_' + Math.random().toString(36).substr(2, 9).toUpperCase();
                    
                    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                    successModal.show();
                    
                    // Reset form
                    document.getElementById('transferForm').reset();
                    document.getElementById('paymentType').value = '';
                    document.getElementById('transferDate').value = new Date().toISOString().split('T')[0];
                    document.getElementById('recipientDetailsForm').innerHTML = '';
                    document.getElementById('dynamicSummaryFields').innerHTML = '';
                    document.getElementById('dynamicConfirmFields').innerHTML = '';
                    document.getElementById('currencyConverter').classList.add('d-none');
                    document.getElementById('convertedAmountSummary').classList.add('d-none');
                    document.getElementById('convertedAmountConfirm').classList.add('d-none');
                    
                    // Update user data
                    fetchUserData();
                    
                    // Reset to step 1
                    document.getElementById('step4').classList.add('d-none');
                    document.getElementById('step1').classList.remove('d-none');
                    updateStepIndicator(1);
                    currentStep = 1;
                } else {
                    throw new Error(data.message || 'Transfer failed');
                }
            })
            .catch(error => {
                console.error('Transfer error:', error);
                
                // Show error modal
                document.getElementById('errorMessage').textContent = error.message;
                const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
                errorModal.show();
            })
            .finally(() => {
                // Reset button state
                confirmBtn.disabled = false;
                confirmBtn.innerHTML = 'Confirm Transfer';
            });
        }
        
        // Print receipt functionality
        document.getElementById('printReceipt').addEventListener('click', function() {
            window.print();
        });
    </script>
</body>
</html>